# Web3 信息聚合产品 - 技术路线文档

> 本文档供开发人员参考，明确技术选型、系统架构和关键配置，减少摸索成本。

---

## 一、项目概述

### 1.1 产品定位
Web3 个性化信息聚合订阅服务，通过 AI 筛选每日有价值的信息，生成 10 分钟可读完的简报，通过 Telegram 推送给用户。

### 1.2 MVP 目标
| 指标 | 目标值 |
|------|--------|
| 支持用户数 | 100 人 |
| 信息源类型 | Twitter + 网站 |
| 推送渠道 | Telegram |
| 推送频率 | 每天 1 次 |

### 1.3 核心原则

**"More Intelligence, Less Structure"**

| 原则 | 说明 |
|------|------|
| **AI 主导决策** | 让 AI 决定怎么筛选、怎么组织，减少硬编码规则 |
| **自然语言画像** | 用户偏好用自然语言描述，不用结构化标签/权重 |
| **Prompt 即产品** | 核心逻辑通过 Prompt 定义，可快速迭代 |
| **反馈驱动进化** | 用户反馈 → AI 学习 → 画像更新 → 推送优化 |

### 1.4 MVP 核心能力优先级

```
P0（必须有）：
├── AI 个性化筛选 ← 核心价值
├── 用户反馈学习闭环 ← 核心机制
├── 价值可感知展示 ← 让用户感知价值
└── Telegram 推送 ← 交付载体

P1（应该有）：
├── 用户自定义信息源
└── 推送时间配置

P2（可以后做）：
├── 付费功能区分
└── 历史简报查看
```

---

## 二、技术选型决策

### 2.1 技术栈总览

| 模块 | 选型 | 说明 |
|------|------|------|
| **核心框架** | WiseFlow | LLM 驱动的信息抓取和筛选，**产品核心** |
| **推送能力** | 借鉴 TrendRadar | 复用其 Telegram 推送模块代码 |
| **Twitter 信源** | RSS.app | SaaS 服务，将 Twitter 转为 RSS，~$9/月 |
| **AI 服务** | OpenAI 兼容 API | 硅基流动 / DeepSeek 等国内服务 |
| **数据存储** | JSON 文件 | 轻量灵活，符合 MVP 规模 |
| **部署** | Docker | 单机部署，简单运维 |

### 2.2 选型理由

**为什么 WiseFlow 是核心？**

PRD 定位：
> WiseFlow - **核心**：LLM 驱动的信息抓取和筛选  
> TrendRadar - **参考**：Telegram 推送模块

WiseFlow 提供的核心能力：
- `ExtractManager` - LLM 驱动的内容提取和理解
- `general_process.py` - 多源信息抓取和处理流程
- `llmuse.py` - LLM 调用封装和 Prompt 模板
- 异步数据库管理 - 信息存储和查询

**TrendRadar 的价值是什么？**

仅借鉴其推送模块：
- `senders.py` 中的 `send_to_telegram()` 函数
- 消息分批发送机制
- Telegram 消息格式化

**为什么用 RSS.app？**
- Twitter/X API 限制严格，官方 API 收费高
- 自建爬虫风险高（封号、反爬）
- RSS.app 提供稳定的 Twitter → RSS 转换，~$9/月

**为什么用 JSON 而不是数据库？**

符合 "More Intelligence, Less Structure"：
- 用户画像就是一段自然语言文本，存 JSON 足够
- 100 用户规模无需复杂数据库
- 便于调试和版本控制

---

## 三、系统架构

### 3.1 MVP 架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        MVP 系统架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    信息采集层                             │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────────────┐ │   │
│  │  │ RSS.app    │  │ Web3 网站  │  │ WiseFlow 抓取引擎  │ │   │
│  │  │ (Twitter   │  │ 原生 RSS   │  │ (统一调度和存储)   │ │   │
│  │  │  → RSS)    │  │            │  │                    │ │   │
│  │  └─────┬──────┘  └─────┬──────┘  └─────────┬──────────┘ │   │
│  │        └───────────────┴───────────────────┘            │   │
│  └──────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                AI 筛选层（核心）                          │   │
│  │                                                          │   │
│  │  ┌────────────────┐    ┌────────────────────────────┐   │   │
│  │  │ 用户画像       │    │ AI 筛选引擎                │   │   │
│  │  │ (自然语言)     │───→│ • 理解用户画像             │   │   │
│  │  │                │    │ • 判断信息价值             │   │   │
│  │  └────────────────┘    │ • 个性化排序               │   │   │
│  │         ↑              │ • 生成简报                 │   │   │
│  │         │              └─────────────┬──────────────┘   │   │
│  │  ┌──────┴─────────┐                  │                  │   │
│  │  │ AI 画像更新    │                  │                  │   │
│  │  │ (分析反馈)     │                  │                  │   │
│  │  └────────────────┘                  │                  │   │
│  └──────────────────────────────────────┼──────────────────┘   │
│                                         ↓                       │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    推送与反馈层                           │   │
│  │  ┌────────────────────┐    ┌────────────────────────┐   │   │
│  │  │ Telegram 推送      │    │ 反馈收集               │   │   │
│  │  │ (借鉴 TrendRadar)  │    │ • 👍/👎 整体评价       │   │   │
│  │  │ • 分批发送         │    │ • 单条信息反馈         │   │   │
│  │  │ • 格式化消息       │    │ • 不满意原因           │   │   │
│  │  └────────────────────┘    └───────────┬────────────┘   │   │
│  │                                        │                │   │
│  └────────────────────────────────────────┼────────────────┘   │
│                                           │                     │
│                                           ↓                     │
│                                    反馈数据存储                  │
│                                    (JSON 文件)                   │
│                                           │                     │
│                              ┌────────────┘                     │
│                              ↓                                  │
│                       AI 分析反馈                               │
│                       更新用户画像                              │
│                       (闭环)                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 核心数据流

```
每日执行流程：

1. 信息采集（定时任务）
   RSS.app + 网站 RSS → WiseFlow 抓取 → 原始信息池

2. AI 筛选（每用户）
   读取用户画像 → 注入 Prompt → AI 筛选 → 个性化内容列表

3. 简报生成（每用户）
   个性化内容 → AI 组织结构 → 生成价值统计 → 格式化简报

4. 推送（每用户）
   简报 → Telegram Bot → 用户

5. 反馈收集（异步）
   用户点击反馈 → 记录到 JSON

6. 画像更新（定期）
   累积反馈 → AI 分析 → 更新自然语言画像
```

---

## 四、关键配置说明

### 4.1 WiseFlow 核心配置

**环境变量 (.env)**
```bash
# LLM 配置
LLM_API_BASE="https://api.siliconflow.cn/v1"
LLM_API_KEY="your_api_key"
PRIMARY_MODEL="Qwen/Qwen3-32B"

# 并发控制
LLM_CONCURRENT_NUMBER=3
```

**Focus 配置（用户关注点）**
```python
# 每个用户对应一个 focus 配置
focus = {
    "id": "user_001",
    "focuspoint": "Web3, DeFi, Layer2, 以太坊",  # 关注领域
    "restrictions": "",  # 筛选限制（可选）
    "role": "Web3 信息助手",
    "purpose": "为用户筛选每日最有价值的 Web3 信息"
}
```

### 4.2 RSS.app 配置

**Twitter 账号转 RSS（PRD 预设信息源）**

| 类别 | 账号 | RSS.app 操作 |
|------|------|-------------|
| **行业领袖** | @VitalikButerin | 输入用户名，生成 RSS |
| | @cz_binance | 同上 |
| | @brian_armstrong | 同上 |
| **链上数据** | @whale_alert | 同上 |
| | @lookonchain | 同上 |
| | @EmberCN | 同上 |
| | @ai_9684xtpa | 同上 |
| **项目官方** | @ethereum | 同上 |
| | @solana | 同上 |
| | @arbitrum | 同上 |
| | @optimism | 同上 |
| **媒体** | @CoinDesk | 同上 |
| | @TheBlock__ | 同上 |
| | @WuBlockchain | 同上 |
| | @BlockBeatsAsia | 同上 |

**网站 RSS（原生支持）**

| 网站 | RSS 地址 |
|------|---------|
| The Block | https://www.theblock.co/rss.xml |
| CoinDesk | https://www.coindesk.com/arc/outboundfeeds/rss/ |
| 金色财经 | 需确认 |
| 律动 BlockBeats | 需确认 |
| Foresight News | 需确认 |

### 4.3 Telegram Bot 配置

**创建步骤**
1. Telegram 搜索 `@BotFather`
2. 发送 `/newbot`
3. 设置名称（如 "Web3 Daily"）
4. 获取 Bot Token

**Bot 命令设计**
```
/start - 开始使用，注册用户
/profile - 查看/更新我的偏好
/feedback - 主动反馈
/help - 帮助
```

**消息格式（借鉴 TrendRadar）**
- 使用 Markdown 格式
- 分批发送（单条消息限制 4096 字符）
- 内联按钮实现反馈收集

---

## 五、数据管理方案

### 5.1 设计原则

**符合 "More Intelligence, Less Structure"**：
- 用户画像 = 一段自然语言文本
- 不用结构化标签、不用数值权重
- AI 自己理解画像，自己决定如何使用

### 5.2 数据结构

**目录结构**
```
data/
├── users.json              # 用户基本信息
├── profiles/
│   └── {user_id}.txt       # 用户画像（纯文本）
├── feedback/
│   └── {date}.json         # 每日反馈记录
└── daily_stats/
    └── {date}.json         # 每日统计（用于价值展示）
```

**users.json**
```json
{
  "users": [
    {
      "id": "user_001",
      "telegram_id": "123456789",
      "created": "2026-01-11",
      "last_active": "2026-01-11"
    }
  ]
}
```

**profiles/{user_id}.txt（核心：自然语言画像）**
```
这是一个技术导向的 DeFi/L2 深度用户。

【特别关注】
- Arbitrum 生态动态，尤其是空投和激励活动
- 以太坊技术路线图和升级进展
- L2 赛道的融资和新项目
- @VitalikButerin 和 @lookonchain 的内容

【明确不喜欢】
- Meme 币相关内容（多次标记不感兴趣）
- 纯价格预测和技术分析
- 信息量过多，偏好精简（10-15 条）

【历史反馈摘要】
- 2026-01-10：漏掉 Arbitrum 空投信息，用户不满
- 整体满意度较高，喜欢技术深度内容
```

**feedback/{date}.json**
```json
{
  "date": "2026-01-11",
  "feedbacks": [
    {
      "user_id": "user_001",
      "time": "08:35",
      "overall": "positive",
      "item_feedbacks": [
        {"item_id": "001", "rating": "like"},
        {"item_id": "005", "rating": "dislike"}
      ]
    }
  ]
}
```

**daily_stats/{date}.json（用于价值展示）**
```json
{
  "date": "2026-01-11",
  "sources_monitored": 58,
  "raw_items_scanned": 847,
  "users": {
    "user_001": {
      "items_selected": 15,
      "filter_rate": "1.8%",
      "estimated_time_saved_minutes": 150
    }
  }
}
```

---

## 六、AI Prompt 设计

### 6.1 内容筛选 Prompt

```markdown
你是一个 Web3 信息筛选专家。

## 你的任务
为用户从今日信息中筛选出最有价值的内容，生成个性化简报。

## 用户画像（请仔细阅读并遵循）
{user_profile}

## 今日待筛选信息（共 {total_count} 条）
{content_list}

## 筛选原则
1. 深度理解用户画像中的偏好和厌恶
2. 优先选择用户"特别关注"的内容
3. 严格过滤用户"明确不喜欢"的内容
4. 注意用户的历史反馈，避免重复问题
5. 控制数量在用户偏好范围内

## 输出要求
选出最有价值的信息，按重要性排序，输出 JSON 格式：
[
  {
    "id": "原始信息ID",
    "title": "标题",
    "summary": "一句话摘要（中文，20字内）",
    "source": "来源",
    "importance": "high/medium",
    "reason": "为什么选这条（内部参考，不展示给用户）"
  }
]
```

### 6.2 简报生成 Prompt

```markdown
你是一个 Web3 资讯编辑。

## 任务
将筛选好的内容组织成一份简洁、有层次的每日简报。

## 用户画像
{user_profile}

## 已筛选内容
{selected_contents}

## 简报结构要求

1. **今日必看（Top 3）**
   - 选出最重要的 3 条，每条包含：
   - 简短标题 + 一句话摘要 + 来源 + 原文链接

2. **更多信息（按主题分类）**
   - 按主题聚合其余内容
   - 每个主题 2-5 条
   - 格式：• 标题 (来源) 🔗

3. **价值统计**（使用以下数据）
   - 监控信息源: {sources_count} 个
   - 扫描原始信息: {raw_count} 条
   - 为您精选: {selected_count} 条（仅占 {filter_rate}）
   - 今日为您节省: 约 {time_saved} 小时

4. **反馈入口**
   - 今天的简报对你有帮助吗？
   - [👍 有用]  [👎 不太行]

## 输出格式
直接输出 Markdown 格式的简报内容，可发送到 Telegram。
```

### 6.3 画像更新 Prompt

```markdown
你是一个用户偏好分析专家。

## 任务
分析用户的反馈历史，更新用户画像（自然语言描述）。

## 当前用户画像
{current_profile}

## 最近 7 天的反馈记录
{recent_feedbacks}

## 分析要求
1. 用户点"不感兴趣"的内容 → 理解为什么不喜欢
2. 用户点"很有用"的内容 → 理解为什么喜欢
3. 用户说"漏掉重要信息" → 需要关注什么
4. 用户说"信息太多" → 需要更精简
5. 整体评价趋势 → 调整方向

## 输出要求
输出更新后的用户画像，纯文本格式，包含：
- 【特别关注】
- 【明确不喜欢】
- 【历史反馈摘要】

注意：
- 用自然语言描述，不要用结构化标签
- 保留历史重要信息，做增量更新
- 新发现的偏好要明确写出来
```

---

## 七、验收标准

### Phase 0：基础能力验证（快速跑通）

- [ ] WiseFlow 环境搭建完成，能运行
- [ ] RSS.app 账号创建，至少生成 5 个 Twitter RSS
- [ ] 网站 RSS 源配置完成（至少 3 个）
- [ ] Telegram Bot 创建完成
- [ ] 能手动触发一次完整流程：抓取 → 筛选 → 推送

### Phase 1：核心功能完整

- [ ] **AI 筛选**：不同用户收到不同内容（基于画像）
- [ ] **价值展示**：简报包含"今日为您做了什么"统计
- [ ] **反馈收集**：简报底部有 👍/👎 按钮，点击能记录
- [ ] 每日定时推送正常运行
- [ ] 至少 10 个信息源稳定抓取

### Phase 2：反馈闭环生效

- [ ] 反馈数据正常累积
- [ ] AI 画像更新逻辑运行正常
- [ ] 验证：连续 3 天反馈后，用户画像有明显更新
- [ ] 验证：画像更新后，推送内容有相应变化
- [ ] 单条信息反馈（👎不感兴趣 / ⭐很有用）功能可用

### Phase 3：用户体验优化

- [ ] 用户可通过 Bot 命令查看/更新偏好
- [ ] 用户可添加自定义 Twitter 账号
- [ ] 不满意时的原因选择功能
- [ ] 累计节省时间统计

---

## 八、参考资源

### 8.1 核心代码参考

| 文件 | 位置 | 用途 |
|------|------|------|
| 抓取流程 | `WiseFlow/core/general_process.py` | 理解信息采集流程 |
| 内容提取 | `WiseFlow/core/wis/extractor.py` | 理解 LLM 提取逻辑 |
| LLM 调用 | `WiseFlow/core/wis/llmuse.py` | 复用 LLM 封装 |
| Telegram 推送 | `TrendRadar/trendradar/notification/senders.py` | 借鉴推送代码 |

### 8.2 第三方服务

| 服务 | 地址 | 用途 | 费用 |
|------|------|------|------|
| RSS.app | https://rss.app | Twitter → RSS | ~$9/月 |
| 硅基流动 | https://siliconflow.cn | LLM API | 按量付费 |
| DeepSeek | https://deepseek.com | LLM API | 按量付费 |
| Telegram BotFather | @BotFather | 创建 Bot | 免费 |

### 8.3 相关文档

- `【定稿】产品需求文档_PRD_Final.md` - 产品需求（必读）
- `WiseFlow/README.md` - WiseFlow 部署指南
- `TrendRadar/README.md` - TrendRadar 参考

---

## 九、常见问题 FAQ

### Q1: 为什么用户画像是纯文本而不是结构化数据？

**答**：遵循 PRD 的 "More Intelligence, Less Structure" 原则。
- 自然语言描述更灵活，能表达复杂、模糊的偏好
- AI 更容易理解自然语言
- 避免硬编码规则，让 AI 自己决定如何使用画像
- 换更强的模型时，理解能力自动提升

### Q2: RSS.app 免费版够用吗？

**答**：不够。免费版限制 Feed 数量（约 1-3 个），建议直接用付费版（$9/月）。PRD 中预设的 Twitter 账号有 15+ 个。

### Q3: 如何实现"不同用户收到不同内容"？

**答**：
1. 遍历用户列表
2. 读取每个用户的自然语言画像
3. 将画像注入筛选 Prompt
4. AI 基于画像筛选出个性化内容
5. 分别推送给每个用户

### Q4: 反馈按钮怎么实现？

**答**：Telegram Bot 的 Inline Keyboard 功能。
```python
# 伪代码
keyboard = [
    [InlineKeyboardButton("👍 有用", callback_data="feedback_positive")],
    [InlineKeyboardButton("👎 不太行", callback_data="feedback_negative")]
]
```
用户点击后，Bot 收到 callback，记录反馈到 JSON 文件。

### Q5: 画像多久更新一次？

**答**：建议每周更新一次，或累积 5 次以上反馈后触发。频繁更新可能导致画像不稳定。

### Q6: 价值统计的数据怎么来？

**答**：
- `监控信息源` = 配置的 RSS 源数量
- `扫描原始信息` = 当日抓取的原始条目数（WiseFlow 记录）
- `为您精选` = AI 筛选后的条目数
- `节省时间` = (原始条目数 - 精选数) × 平均阅读时间（如 2 分钟/条）

### Q7: WiseFlow 和 TrendRadar 的代码怎么整合？

**答**：
- **主体框架**：基于 WiseFlow 改造
- **推送模块**：从 TrendRadar 复制 `send_to_telegram()` 函数
- **不是**把两个项目合并，而是 WiseFlow 为主 + 借鉴 TrendRadar 推送代码

---

*文档版本：v2.0*  
*最后更新：2026-01-11*
